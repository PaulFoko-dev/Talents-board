<div class="form-container">
  <header class="form-header">
    <h1>Cr√©er un nouveau ticket candidat</h1>
    <p>Remplissez les informations ci-dessous pour cr√©er votre demande d'opportunit√©s.</p>
  </header>

  <!-- FORMULAIRE DE CREATION -->
  <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()" novalidate *ngIf="!createdTicket">
    <div class="form-group">
      <label for="title">Titre du profil / Poste recherch√©</label>
      <input id="title" formControlName="title" type="text" class="form-control" required>
    </div>

    <div class="form-group">
      <label for="localisation">Localisation souhait√©e</label>
      <input id="localisation" formControlName="localisation" type="text" class="form-control">
    </div>

    <div class="form-group">
      <label for="domaine">Domaine d'activit√©</label>
      <select id="domaine" formControlName="domaine" class="form-control">
        <option value="">S√©lectionnez...</option>
        <option *ngFor="let domaine of domaines" [value]="domaine">{{ domaine }}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="niveauExperience">Niveau d'exp√©rience</label>
      <select id="niveauExperience" formControlName="niveauExperience" class="form-control">
        <option value="">S√©lectionnez...</option>
        <option *ngFor="let niveau of niveauxExperience" [value]="niveau">{{ niveau }}</option>
      </select>
    </div>

    <fieldset class="form-group-fieldset">
      <legend>Attentes salariales (‚Ç¨ brut annuel)</legend>
      <div class="fieldset-content">
        <input type="number" formControlName="salaireMinExpectation" placeholder="Min" class="form-control me-2">
        <input type="number" formControlName="salaireMaxExpectation" placeholder="Max" class="form-control">
      </div>
    </fieldset>

    <div class="form-group">
      <label for="descriptionRaw">Pr√©sentation / R√©sum√©</label>
      <textarea id="descriptionRaw" formControlName="descriptionRaw" class="form-control" rows="3"></textarea>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="isLoading">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
        {{ isLoading ? 'Cr√©ation...' : 'Cr√©er le ticket' }}
      </button>
    </div>
  </form>

  <!-- ‚úÖ FORMULAIRE DE VALIDATION COMPLET (apr√®s retour API) -->
  <form *ngIf="createdTicket" [formGroup]="validationForm" (ngSubmit)="onValidate()" class="mt-4">
    <h2>üß© Validation des informations extraites</h2>
    <p>Veuillez v√©rifier et corriger les informations avant de valider le ticket.</p>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>Titre</label>
        <input formControlName="title" class="form-control">
      </div>

      <div>
        <label>Localisation</label>
        <input formControlName="localisation" class="form-control">
      </div>

      <div>
        <label>Domaine</label>
        <input formControlName="domaine" class="form-control">
      </div>

      <div>
        <label>Type de contrat</label>
        <input formControlName="typeContrat" class="form-control">
      </div>

      <div>
        <label>Niveau d'exp√©rience</label>
        <input formControlName="niveauExperience" class="form-control">
      </div>

      <div>
        <label>Dipl√¥me requis</label>
        <input formControlName="diplomeRequis" class="form-control">
      </div>

      <div>
        <label>Mode de travail</label>
        <select formControlName="modeTravail" class="form-control">
          <option value="Pr√©sentiel">Pr√©sentiel</option>
          <option value="Hybride">Hybride</option>
          <option value="T√©l√©travail">T√©l√©travail</option>
        </select>
      </div>

      <div>
        <label>Jours t√©l√©travail / semaine</label>
        <input type="number" formControlName="teletravailJourParSemaine" class="form-control">
      </div>

      <div>
        <label>% T√©l√©travail</label>
        <input type="number" formControlName="teletravailPourcentage" class="form-control">
      </div>

      <div>
        <label>Salaire minimum (‚Ç¨)</label>
        <input type="number" formControlName="salaireMin" class="form-control">
      </div>

      <div>
        <label>Salaire maximum (‚Ç¨)</label>
        <input type="number" formControlName="salaireMax" class="form-control">
      </div>
    </div>

    <!-- ‚úÖ LISTES MODERNES -->
    <div class="mt-4">
      <label>Comp√©tences</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let comp of validationForm.value.competences; let i = index">
          {{ comp }}
          <button type="button" (click)="removeItem('competences', i)">√ó</button>
        </span>
        <input placeholder="Ajouter une comp√©tence" (keydown.enter)="addItem($event, 'competences')">
      </div>
    </div>

    <div class="mt-3">
      <label>Langues</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let lang of validationForm.value.languages; let i = index">
          {{ lang }}
          <button type="button" (click)="removeItem('languages', i)">√ó</button>
        </span>
        <input placeholder="Ajouter une langue" (keydown.enter)="addItem($event, 'languages')">
      </div>
    </div>

    <div class="mt-3">
      <label>Avantages</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let adv of validationForm.value.avantages; let i = index">
          {{ adv }}
          <button type="button" (click)="removeItem('avantages', i)">√ó</button>
        </span>
        <input placeholder="Ajouter un avantage" (keydown.enter)="addItem($event, 'avantages')">
      </div>
    </div>

    <div class="mt-4">
      <label>Description</label>
      <textarea formControlName="descriptionRaw" class="form-control" rows="4"></textarea>
    </div>

    <div class="form-actions mt-4">
      <button type="submit" class="btn btn-success" [disabled]="isValidating">
        <span *ngIf="isValidating" class="spinner-border spinner-border-sm"></span>
        {{ isValidating ? 'Validation...' : 'Valider le ticket' }}
      </button>
    </div>
  </form>
</div>
