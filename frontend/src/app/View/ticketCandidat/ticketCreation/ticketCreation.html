<div class="form-container">
  <header class="form-header">
    <h1>Cr√©er un nouveau ticket candidat</h1>
    <p>Remplissez les informations ci-dessous pour cr√©er votre demande d'opportunit√©s.</p>
  </header>

  <!-- FORMULAIRE DE CREATION -->
  <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()" novalidate *ngIf="!createdTicket">
    <div class="form-group">
      <label for="title" class="form-label">Titre du profil / Poste recherch√©</label>
      <input id="title" formControlName="title" type="text" class="form-control" required placeholder="Ex: D√©veloppeur Full Stack">
    </div>

    <div class="form-group">
      <label for="localisation" class="form-label">Localisation souhait√©e</label>
      <input id="localisation" formControlName="localisation" type="text" class="form-control" placeholder="Ex: Paris, Lyon, Remote">
    </div>

    <div class="form-group">
      <label for="domaine" class="form-label">Domaine d'activit√©</label>
      <select id="domaine" formControlName="domaine" class="form-control">
        <option value="">S√©lectionnez...</option>
        <option *ngFor="let domaine of domaines" [value]="domaine">{{ domaine }}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="niveauExperience" class="form-label">Niveau d'exp√©rience</label>
      <select id="niveauExperience" formControlName="niveauExperience" class="form-control">
        <option value="">S√©lectionnez...</option>
        <option *ngFor="let niveau of niveauxExperience" [value]="niveau">{{ niveau }}</option>
      </select>
    </div>

    <fieldset class="form-group-fieldset">
      <legend>Attentes salariales (‚Ç¨ brut annuel)</legend>
      <div class="fieldset-content">
        <div class="form-group">
          <input type="number" formControlName="salaireMinExpectation" placeholder="Minimum" class="form-control">
        </div>
        <div class="form-group">
          <input type="number" formControlName="salaireMaxExpectation" placeholder="Maximum" class="form-control">
        </div>
      </div>
    </fieldset>

    <div class="form-group">
      <label for="descriptionRaw" class="form-label">Pr√©sentation / R√©sum√©</label>
      <textarea id="descriptionRaw" formControlName="descriptionRaw" class="form-control" rows="4" placeholder="D√©crivez votre profil et vos attentes..."></textarea>
    </div>

    <div class="form-group">
      <label for="cv" class="form-label">Ajouter votre CV (PDF uniquement)</label>
      <input 
        id="cv" 
        type="file" 
        (change)="onCvChange($event)" 
        class="form-control"
        accept=".pdf"
      >
      <div *ngIf="cv?.invalid && (cv?.dirty || cv?.touched)" class="invalid-feedback">
        <small *ngIf="cv?.errors?.['required']">Un CV est requis.</small>
        <small *ngIf="cv?.errors?.['fileType']">Le fichier doit √™tre au format PDF.</small>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="isLoading">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
        {{ isLoading ? 'Cr√©ation...' : 'Cr√©er le ticket' }}
      </button>
    </div>
  </form>

  <!-- ‚úÖ FORMULAIRE DE VALIDATION COMPLET (apr√®s retour API) -->
  <form *ngIf="createdTicket" [formGroup]="validationForm" (ngSubmit)="onValidate()" class="validation-form">
    <h2>üß© Validation des informations extraites</h2>
    <p>Veuillez v√©rifier et corriger les informations avant de valider le ticket.</p>

    <div class="grid">
      <div>
        <label class="form-label">Titre</label>
        <input formControlName="title" class="form-control">
      </div>

      <div>
        <label class="form-label">Localisation</label>
        <input formControlName="localisation" class="form-control">
      </div>

      <div>
        <label class="form-label">Domaine</label>
        <input formControlName="domaine" class="form-control">
      </div>

      <div>
        <label class="form-label">Type de contrat</label>
        <input formControlName="typeContrat" class="form-control">
      </div>

      <div>
        <label class="form-label">Niveau d'exp√©rience</label>
        <input formControlName="niveauExperience" class="form-control">
      </div>

      <div>
        <label class="form-label">Dipl√¥me requis</label>
        <input formControlName="diplomeRequis" class="form-control">
      </div>

      <div>
        <label class="form-label">Mode de travail</label>
        <select formControlName="modeTravail" class="form-control">
          <option value="Pr√©sentiel">Pr√©sentiel</option>
          <option value="Hybride">Hybride</option>
          <option value="T√©l√©travail">T√©l√©travail</option>
        </select>
      </div>

      <div>
        <label class="form-label">Jours t√©l√©travail / semaine</label>
        <input type="number" formControlName="teletravailJourParSemaine" class="form-control">
      </div>

      <div>
        <label class="form-label">% T√©l√©travail</label>
        <input type="number" formControlName="teletravailPourcentage" class="form-control">
      </div>

      <div>
        <label class="form-label">Salaire minimum (‚Ç¨)</label>
        <input type="number" formControlName="salaireMin" class="form-control">
      </div>

      <div>
        <label class="form-label">Salaire maximum (‚Ç¨)</label>
        <input type="number" formControlName="salaireMax" class="form-control">
      </div>
    </div>

    <!-- ‚úÖ LISTES MODERNES -->
    <div class="form-group">
      <label class="form-label">Comp√©tences</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let comp of validationForm.value.competences; let i = index">
          {{ comp }}
          <button type="button" (click)="removeItem('competences', i)">√ó</button>
        </span>
        <input placeholder="Ajouter une comp√©tence" (keydown.enter)="addItem($event, 'competences')">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Langues</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let lang of validationForm.value.languages; let i = index">
          {{ lang }}
          <button type="button" (click)="removeItem('languages', i)">√ó</button>
        </span>
        <input placeholder="Ajouter une langue" (keydown.enter)="addItem($event, 'languages')">
      </div>
    </div>

    <!-- <div class="form-group">
      <label class="form-label">Avantages</label>
      <div class="tag-container">
        <span class="tag" *ngFor="let adv of validationForm.value.avantages; let i = index">
          {{ adv }}
          <button type="button" (click)="removeItem('avantages', i)">√ó</button>
        </span>
        <input placeholder="Ajouter un avantage" (keydown.enter)="addItem($event, 'avantages')">
      </div>
    </div> -->

    <div class="form-group">
      <label class="form-label">Description</label>
      <textarea formControlName="descriptionRaw" class="form-control" rows="4"></textarea>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-success" [disabled]="isValidating">
        <span *ngIf="isValidating" class="spinner-border spinner-border-sm"></span>
        {{ isValidating ? 'Validation...' : 'Valider le ticket' }}
      </button>
    </div>
  </form>
</div>